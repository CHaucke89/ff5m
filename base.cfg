[skew_correction]

# Регулировка винтов
[screws_tilt_adjust]
screw1: -94, -94
screw1_name: front left screw
screw2: 94, -94
screw2_name: front right screw
screw3: 94, 94
screw3_name: rear right screw
screw4: -94, 94
screw4_name: rear left screw
horizontal_move_z: 10.
speed: 600.
screw_thread: CW-M4

# Макрос для M300 - Звук
[gcode_shell_command audio_freq]
command: audio freq
timeout: 3
verbose: False

[gcode_macro M300]
description: Воспроизвести тон
gcode:
    # Use a default 1kHz tone if S is omitted.
    {% set S = params.S|default(1000)|int %}
    # Use a 10ms duration is P is omitted.
    {% set P = params.P|default(100)|float %}
    RUN_SHELL_COMMAND CMD=audio_freq PARAMS="-f {S} -d {P / 1000}"

# Лунная соната
[gcode_macro M356]
description: Лунная соната
gcode:
    M300 S1318 P50
    M300 S1244 P50
    M300 S1318 P50
    M300 S1244 P50
    M300 S1318 P50
    M300 S987 P50
    M300 S1174 P50
    M300 S1046 P50
    M300 S880 P100

[gcode_macro CHECK_MD5]
description: Проверка MD5 суммы файла
gcode:
  {% if 'FILENAME' in params %}
    {% set filename = params.FILENAME|default("")|string %}
  {% else %}
    {% set filename = printer.virtual_sdcard.file_path|default("")|string  %}
  {% endif %}

  {% if filename != "" %}
    {% if "xyz" not in printer.toolhead.homed_axes %}
        G28
    {% endif %}

    {% if 'DELETE' in params %}
      {% set delete = params.DELETE|default("false")|string %}
    {% endif %}

    RUN_SHELL_COMMAND CMD=check_md5 PARAMS={'"%s %s"' % (filename.replace(" ", "\ "), delete)}
  {% endif %}

# Проверка чек суммы md5
[gcode_shell_command check_md5]
command: /root/printer_data/scripts/checkMD5.sh
timeout: 65.
verbose: False

[gcode_macro SET_BED_TEMPERATURE]
description: Установить температуру стола
gcode:
    {% set temperature = params.TARGET|default(80) %}
    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={temperature}

[gcode_macro BED_TEMPERATURE_WAIT]
description: Ожидать, пока установится температура стола
gcode:
    {% if params.MINIMUM is defined and params.MAXIMUM is defined %}
      TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={params.MINIMUM} MAXIMUM={params.MAXIMUM}
    {% elif params.MINIMUM is defined %}
      TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={params.MINIMUM}
    {% elif params.MAXIMUM is defined %}
      TEMPERATURE_WAIT SENSOR=heater_bed MAXIMUM={params.MAXIMUM}
    {% else %}
      RESPOND TYPE=error MSG="Error on 'BED_TEMPERATURE_WAIT': missing MINIMUM or MAXIMUM."
    {% endif %}

[gcode_macro BED_LEVEL_SCREWS_TUNE]
description: Калибровка винтов стола
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP|default(240)|float %}
    {% set bed_temp = params.BED_TEMP|default(80)|float %}

    RESPOND TYPE=echo MSG="До измерений, не забудьте почистить сопло макросом CLEAR_NOIZE"

    BED_MESH_CLEAR
    SET_BED_TEMPERATURE TARGET={bed_temp}
    BED_TEMPERATURE_WAIT MINIMUM={bed_temp-2} MAXIMUM={bed_temp+3}
    G28
    SCREWS_TILT_CALCULATE

[gcode_macro LOAD_CELL_TARE]
description: Сбросить тензодатчики
variable_success: 0
gcode:
    # Устанавливаем, что датчики не сброшены
    SET_GCODE_VARIABLE MACRO=LOAD_CELL_TARE VARIABLE=success VALUE=0

    # Пробуем 10 раз сбросить тензодатчики
    {% for i in range(10) %}
        {% if not printer["gcode_macro LOAD_CELL_TARE"].success %}
            _LOAD_CELL_TARE_SET
            _LOAD_CELL_TARE_CHECK
        {% endif %}
    {% endfor %}
    # Проверяем - все ли в порядке
    _LOAD_CELL_TARE_FINAL_CHECK

[gcode_macro _LOAD_CELL_TARE_SET]
gcode:
    # Устанавливаем level_h1 в 0 и 1, 2 раза 
    SET_PIN PIN=level_h1 VALUE=0
    G4 P500     ; делаем паузу при выполнеии
    M400
    SET_PIN PIN=level_h1 VALUE=1
    G4 P500
    M400
    SET_PIN PIN=level_h1 VALUE=0
    G4 P500
    M400
    SET_PIN PIN=level_h1 VALUE=1
    G4 P500
    M400

[gcode_macro _LOAD_CELL_TARE_CHECK]
gcode:
    # Если все в порядке, ставим переменную success в 1
    {% if "PRESSED" in printer['gcode_button check_level_pin'].state %}
        SET_GCODE_VARIABLE MACRO=LOAD_CELL_TARE VARIABLE=success VALUE=1
    {% endif %}

[gcode_macro _LOAD_CELL_TARE_FINAL_CHECK]
gcode:
    # Если все в порядке
    {% if printer["gcode_macro LOAD_CELL_TARE"].success %}
        # Передергиваем level_clear пин и фиксируемся
        SET_PIN PIN=level_clear VALUE=0
        G4 P10
        M400
        SET_PIN PIN=level_clear VALUE=1
        G4 P10
        M400
        RESPOND TYPE=echo MSG="Загрузка тензодатчиков успешна."
    # Else raise error
    {% else %}
        {action_raise_error("Загрузка тензодатчиков ОШИБКА.")}
    {% endif %}

[gcode_macro CLEAR_NOIZE]
description: Очистка сопла
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP|default(230)|float %}
    {% set bed_temp = params.BED_TEMP|default(80)|float %}

    RESPOND PREFIX="info" MSG="Запущена родная очистка сопла {extruder_temp}/{bed_temp}"

    G28                      ; Идем домой
    M400

    # Греем стол
    G90                      ; Абсолютные координаты
    G1 Z50 F6000             ; Поднимаем стол

    G1 X-20 Y111 F6000       ; Зависаем по центру
    G1 Z5 F3000
    M400

    LOAD_CELL_TARE           ; Сбрасываем тензодатчики

    M190 S{bed_temp}         ; Греем стол со стабилизацией
    M109 S{extruder_temp} T0 ; Греем экструдер со стабилизацией

    LOAD_CELL_TARE           ; Сбрасываем тензодатчики

#    PROBE_CALIBRATE          ; Замеряем Z-Offset
#    ABORT                    ; но не сохраняем.
    PROBE                    ; Замеряем Z-Offset
    {% set zprobe = printer.probe.last_z_result %}

    G92 E0                   ; обнуляем количество выдавленного пластика

    G1 X-10 F3000
    G1 X-10 Y111 Z{zprobe+0.15} F3000 ; z+0.15
    G1 X20 F1200
    G1 X20 Y110 F1200
    G1 X0 Y110 F1200
    G1 X0 Y109 F1200
    G1 X20 Y109 F1200
    G1 X-10 Y108 F1200
    G1 Z{zprobe+0.15} F3000  ; z+0.05

    M109 S120 T0             ; Снижаем температуру до 120 градусов

    G1 X-20 Y107 F1200       ; Убираем сопло от стола
    M400
    G1 Z5 F6000
    M400

    LOAD_CELL_TARE           ; Сбрасываем тензодатчики


[gcode_macro _FULL_BED_LEVEL]
description: Калибровка стола без выключения температуры
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP|default(240)|float %}
    {% set bed_temp = params.BED_TEMP|default(80)|float %}
    {% set profile = params.PROFILE|default("auto") %}

    RESPOND PREFIX="info" MSG="Калибровка стола. Профиль {profile}. {extruder_temp}/{bed_temp}"

    BED_MESH_CLEAR          ; Очистка профиля стола

    CLEAR_NOIZE EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}

    # Начинаем калибровку
    BED_MESH_CALIBRATE PROFILE="{profile}"

[gcode_macro AUTO_FULL_BED_LEVEL]
description: Калибровка стола
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP|default(240)|float %}
    {% set bed_temp = params.BED_TEMP|default(80)|float %}
    {% set profile = params.PROFILE|default("auto") %}

    _FULL_BED_LEVEL EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp} PROFILE={profile}

    # Выклчюаем обогрев
    _STOP

# Калибровка PID стола
[gcode_macro M357]
description: Калибровка PID стола
gcode:
  {% if 'E' in params %}
      PID_CALIBRATE HEATER=heater_bed TARGET={params.E}
  {% else %}
      PID_CALIBRATE HEATER=heater_bed TARGET=80
  {% endif %}
  SAVE_CONFIG

[gcode_macro PID_Tune_BED]
description: Калибровка PID стола
gcode:
  {% set temperature = params.TEMPERATURE|default(80) %}
  G28
  M106 S255 ;Sets Print Fans to 100%
  PID_CALIBRATE HEATER=heater_bed TARGET={temperature}
  SAVE_CONFIG

# Калибровка PID экструдера
[gcode_macro PID_Tune_EXTRUDER]
description: Калибровка PID экструдера
gcode:
  {% set temperature = params.TEMPERATURE|default(245) %}
  G28
  M106 S255
  PID_CALIBRATE HEATER=extruder TARGET={temperature}
  SAVE_CONFIG


[gcode_macro LOAD_FILAMENT]
variable_load_distance:  125
gcode:
    {% set speed = params.SPEED|default(450) %}
    {% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity  * 60 %}
    SAVE_GCODE_STATE NAME=load_state
    G91
    G92 E0
    G1 E{load_distance} F{speed} ; extrude with 7.5mm/s
    RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
variable_unload_distance:  75
gcode:
    {% set speed = params.SPEED|default(450) %}
    SAVE_GCODE_STATE NAME=unload_state
    G91
    G92 E0
    G1 E-{unload_distance} F{speed} ; unload
    RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro PURGE_FILAMENT]
variable_purge_distance:  25
gcode:
    {% set speed = params.SPEED|default(450) %}
    SAVE_GCODE_STATE NAME=purge_state
    G91
    G92 E0
    G1 E{purge_distance} F{speed}   ; purge
    RESTORE_GCODE_STATE NAME=purge_state

[gcode_macro LOAD_MATERIAL]
description: Manual filament loading / change
variable_initial_target_temp: 0
gcode:
    # save gcode state
    SAVE_GCODE_STATE NAME=load_material_state
    # save heating state
    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL VARIABLE=initial_target_temp VALUE={printer["extruder"].target}

    _LOAD_MATERIAL_SELECT

[gcode_macro _LOAD_MATERIAL_SELECT]
gcode:
    {% if not printer["extruder"].target >= printer.configfile.settings['extruder'].min_extrude_temp %}
        # material selection
        RESPOND TYPE=command MSG="action:prompt_begin Material Selection"
        RESPOND TYPE=command MSG="action:prompt_text Select the material type to heat the nozzle."
        RESPOND TYPE=command MSG="action:prompt_button_group_start"
        RESPOND TYPE=command MSG="action:prompt_button PLA|_LOAD_MATERIAL_HEATUP TEMP=210|primary"
        RESPOND TYPE=command MSG="action:prompt_button PETG|_LOAD_MATERIAL_HEATUP TEMP=240|primary"
        RESPOND TYPE=command MSG="action:prompt_button ABS|_LOAD_MATERIAL_HEATUP TEMP=250|primary"
        RESPOND TYPE=command MSG="action:prompt_button_group_end"
        RESPOND TYPE=command MSG="action:prompt_footer_button Abort|_LOAD_MATERIAL_END"
        RESPOND TYPE=command MSG="action:prompt_show"
    {% else %}
        # skip preheating dialog, but wait for target temp
        TEMPERATURE_WAIT SENSOR=extruder MINIMUM={printer["extruder"].target}
        _LOAD_MATERIAL_ACTION
    {% endif %}

[gcode_macro _LOAD_MATERIAL_HEATUP]
gcode:
    {% set extruder_temp = params.TEMP|default(200)|float %}
    M104 S{extruder_temp}
    RESPOND TYPE=command MSG=action:prompt_end
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={extruder_temp}
    _LOAD_MATERIAL_ACTION

[gcode_macro _LOAD_MATERIAL_ACTION]
gcode:
    # loading / unloading
    RESPOND TYPE=command MSG="action:prompt_begin Filament Loading"
    RESPOND TYPE=command MSG="action:prompt_text Select filament loading action."
    RESPOND TYPE=command MSG="action:prompt_button_group_start"
    RESPOND TYPE=command MSG="action:prompt_button Load|LOAD_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button Unload|UNLOAD_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button Purge|PURGE_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button_group_end"
    RESPOND TYPE=command MSG="action:prompt_footer_button Done|_LOAD_MATERIAL_END"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _LOAD_MATERIAL_END]
gcode:
    RESPOND TYPE=command MSG="action:prompt_end"
    # restore old temp
    M104 S{printer["gcode_macro LOAD_MATERIAL"].initial_target_temp}
    # restore gcode state
    RESTORE_GCODE_STATE NAME=load_material_state

[gcode_macro M600]
gcode:
    {% set X = params.X|default(printer['gcode_macro _CLIENT_VARIABLE'].custom_park_x)|float %}
    {% set Y = params.Y|default(printer['gcode_macro _CLIENT_VARIABLE'].custom_park_y)|float %}
    {% set Z = params.Z|default(printer['gcode_macro _CLIENT_VARIABLE'].custom_park_dz)|float %}
    PAUSE X={X} Y={Y} Z_MIN={Z}
    M400
    RESPOND TYPE=command MSG="action:prompt_begin Filament change"
    RESPOND TYPE=command MSG="action:prompt_text Filament change requested. Please load new filament and press resume."
    RESPOND TYPE=command MSG="action:prompt_button_group_start"
    RESPOND TYPE=command MSG="action:prompt_button Load|LOAD_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button Unload|UNLOAD_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button Purge|PURGE_FILAMENT|primary"
    RESPOND TYPE=command MSG="action:prompt_button_group_end"
    RESPOND TYPE=command MSG="action:prompt_footer_button Resume|_INTERACTIVE_LOAD_END"
    RESPOND TYPE=command MSG="action:prompt_show"

[gcode_macro _INTERACTIVE_LOAD_END]
gcode:
    RESPOND TYPE=command MSG="action:prompt_end"
    RESUME

[gcode_shell_command sync]
command: sync
timeout: 3
verbose: False

[gcode_shell_command reboot]
command: reboot
timeout: 3
verbose: False

[gcode_shell_command poweroff]
command: poweroff
timeout: 3
verbose: False

[gcode_macro SHUTDOWN]
description: Выключить принтер
gcode:
    RUN_SHELL_COMMAND CMD=sync
    RUN_SHELL_COMMAND CMD=poweroff

[gcode_macro REBOOT]
description: Перезагрузить принтер
gcode:
    RUN_SHELL_COMMAND CMD=sync
    RUN_SHELL_COMMAND CMD=reboot

[gcode_shell_command ztouch]
command: touch
timeout: 5
verbose: True

[gcode_macro REMOVE_ZMOD]
description: Удалить zmod
gcode:
    RUN_SHELL_COMMAND CMD=ztouch PARAMS="/opt/config/mod/REMOVE"
    RUN_SHELL_COMMAND CMD=sync
    RUN_SHELL_COMMAND CMD=reboot

[gcode_macro SKIP_ZMOD]
description: Перезагрузка в оригинальную систему. Без запуска zmod.
gcode:
    RUN_SHELL_COMMAND CMD=ztouch PARAMS="/opt/config/mod/SKIP_ZMOD"
    RUN_SHELL_COMMAND CMD=sync
    RUN_SHELL_COMMAND CMD=reboot

[gcode_macro SOFT_REMOVE]
description: Удалить zmod. Не удалять root, audio, md5
gcode:
    RUN_SHELL_COMMAND CMD=ztouch PARAMS="/opt/config/mod/SOFT_REMOVE"
    RUN_SHELL_COMMAND CMD=sync
    RUN_SHELL_COMMAND CMD=reboot

[gcode_macro LED_ON]
description: Включить подсветку
gcode:
    SET_LED LED=chamber_led WHITE=1

[gcode_macro LED_OFF]
description: Выключить подсветку
gcode:
    SET_LED LED=chamber_led WHITE=0

[gcode_macro LED]
description: Включить подсветку на несколько процентов
gcode:
    {% set S = params.S|default(50)|int %}
    SET_LED LED=chamber_led WHITE={S/100|float}

[gcode_shell_command zdisplay]
command: /root/printer_data/scripts/zdisplay.sh
timeout: 5
verbose: True

[gcode_macro DISPLAY_ON]
description: Включить стандартный экран и перезгрузить принтер
gcode:
    RUN_SHELL_COMMAND CMD=zdisplay PARAMS="on"

[gcode_macro DISPLAY_OFF]
description: Выключить стандартный экран
gcode:
    RUN_SHELL_COMMAND CMD=zdisplay PARAMS="off"
    RESTART

[gcode_shell_command ps_mem]
command: /root/printer_data/scripts/ps_mem.py
timeout: 5
verbose: True

[gcode_shell_command free]
command: free
timeout: 5
verbose: True

[gcode_macro MEM]
description: Посмотреть расход памяти
gcode:
    RUN_SHELL_COMMAND CMD=ps_mem
    RUN_SHELL_COMMAND CMD=free PARAMS="-m"

[gcode_macro AIR_CIRCULATION_INTERNAL]
description: Turn on internal air circulation
gcode:
    SET_FAN_SPEED FAN=external_fan SPEED=0
    SET_FAN_SPEED FAN=internal_fan SPEED=1
    SET_SERVO SERVO=my_servo ANGLE=95

[gcode_macro AIR_CIRCULATION_EXTERNAL]
description: Turn on external air circulation
gcode:
    SET_FAN_SPEED FAN=external_fan SPEED=.8 ;dropped to 80 percent to quiet it down
    SET_FAN_SPEED FAN=internal_fan SPEED=1
    SET_SERVO SERVO=my_servo ANGLE=180

[gcode_macro AIR_CIRCULATION_STOP]
description: Turn off air circulation
gcode:
    SET_FAN_SPEED FAN=external_fan SPEED=0
    SET_FAN_SPEED FAN=internal_fan SPEED=0
    SET_SERVO SERVO=my_servo ANGLE=95

[gcode_shell_command audio_midi]
command: audio_midi.sh
timeout: 30
verbose: True

[gcode_macro PLAY_MIDI]
description: Проиграть MIDI файл
gcode:
    {% set FILE = params.FILE|default("For_Elise.mid")|string %}
    RUN_SHELL_COMMAND CMD=audio_midi PARAMS="{FILE}"

[gcode_shell_command zcamera]
command: /root/printer_data/scripts/zcamera.sh
timeout: 5
verbose: True

[gcode_macro CAMERA_ON]
description: Использовать альтернативную реализацию камеры
gcode:
    RESPOND TYPE=command MSG="action:prompt_begin Отключите камеру на экране принтера"
    RESPOND TYPE=command MSG="action:prompt_end"
    RESPOND TYPE=command MSG="action:prompt_show"
    {% set WIDTH  = params.WIDTH|default(640)|int %}
    {% set HEIGHT = params.HEIGHT|default(480)|int %}
    {% set FPS    = params.FPS|default(15)|int %}
    RUN_SHELL_COMMAND CMD=zcamera PARAMS="on {WIDTH} {HEIGHT} {FPS} RESTART"

[gcode_macro CAMERA_OFF]
description: Отключить альтернативную реализацию камеры
gcode:
    RESPOND TYPE=command MSG="action:prompt_begin Включите камеру на экране принтера"
    RESPOND TYPE=command MSG="action:prompt_end"
    RESPOND TYPE=command MSG="action:prompt_show"
    {% set WIDTH  = params.WIDTH|default(640)|int %}
    {% set HEIGHT = params.HEIGHT|default(480)|int %}
    {% set FPS    = params.FPS|default(15)|int %}
    RUN_SHELL_COMMAND CMD=zcamera PARAMS="off {WIDTH} {HEIGHT} {FPS} RESTART"

[gcode_shell_command date]
command: date
timeout: 30
verbose: True

[gcode_macro DATE_GET]
description: Посмотреть время
gcode:
    {% set DT  = params.DT|default("")|string %}
    RUN_SHELL_COMMAND CMD=date

[gcode_macro DATE_SET]
description: Установить дату и время в формате 2024.01.01-00:00:00
gcode:
    {% set DT  = params.DT|default("2024.01.01-00:00:00")|string %}
    RUN_SHELL_COMMAND CMD=date PARAMS="date {DT}"

[gcode_shell_command zhttp]
command: /root/printer_data/scripts/zhttp.sh
timeout: 5
verbose: True

[gcode_macro WEB]
description: Сменить веб интерфейс fluidd/mainsail
gcode:
    RUN_SHELL_COMMAND CMD=zhttp

[gcode_macro _G17]
gcode:
    RESPOND TYPE=echo MSG="Замените Cпиральный/Автоматич. Z-Hop. Принтер его не поддерживает."
    RESPOND TYPE=echo MSG="В Orca. Профиль принтера -> Экструдер 1 -> Тип подъема оси Z. Установите Обычный или Наклонный."

[gcode_macro G17]
gcode:
    _G17

[gcode_macro G18]
gcode:
    _G17

[gcode_macro G19]
gcode:
    _G17

[gcode_macro _STOP]
description: Отключить нагрев и кулер
gcode:
    M104 S0                 ; Отключить нагрев экструдера
    M140 S0                 ; Отключить нагрев стола
    M107                    ; Отключить кулер экструдера

[gcode_macro STOP]
description: Отключить моторы, кулер, и нагрев
gcode:
    _STOP                   ; Отключить нагрев и кулер
    M84                     ; Выключить мотор

[gcode_shell_command zrm]
command: /root/printer_data/scripts/zrm.sh
timeout: 5
verbose: True

[gcode_shell_command zcp]
command: /root/printer_data/scripts/zcp.sh
timeout: 5
verbose: True

[gcode_macro ZSHAPER]
description: Калибровка шейперов
gcode:
    RUN_SHELL_COMMAND CMD=zrm
    G28
    SHAPER_CALIBRATE
    RUN_SHELL_COMMAND CMD=zcp
    RESPOND TYPE=echo MSG="Шейперы лежат в конфигурации mod_data/."
    RESPOND TYPE=echo MSG="Скачайте оттуда csv файлы."
    RESPOND TYPE=echo MSG="Программа для построения графиков."
    RESPOND TYPE=echo MSG="https://github.com/theycallmek/Klipper-Input-Shaping-Assistant/releases"

[gcode_shell_command ls]
command: ls
timeout: 5
verbose: True

[gcode_shell_command ln]
command: ln
timeout: 5
verbose: True

[gcode_shell_command rm]
command: rm
timeout: 5
verbose: True

[gcode_macro SET_TIMEZONE]
description: Смена часового пояса
gcode:
    {% set ZONE  = params.ZONE|default("Europe/Moscow")|string %}
    RESPOND TYPE=echo MSG="Доступные зоны Europe/."
    RUN_SHELL_COMMAND CMD=ls PARAMS="/usr/share/zoneinfo/Europe"
    RESPOND TYPE=echo MSG="Доступные зоны Asia/."
    RUN_SHELL_COMMAND CMD=ls PARAMS="/usr/share/zoneinfo/Asia"
    RESPOND TYPE=echo MSG="Использование SET_TIMEZONE ZONE=Asia/Yekaterinburg"
    RUN_SHELL_COMMAND CMD=rm PARAMS="/etc/localtime"
    RUN_SHELL_COMMAND CMD=ln PARAMS="-s /usr/share/zoneinfo/{ZONE} /etc/localtime"
    RUN_SHELL_COMMAND CMD=date

[include KAMP_Settings.cfg]

[gcode_macro KAMP]
description: Адаптивная кровать
gcode:
    {% set extruder_temp = params.EXTRUDER_TEMP|default(240)|float %}
    {% set bed_temp = params.BED_TEMP|default(80)|float %}
    {% set profile = params.PROFILE|default("kamp") %}

    BED_MESH_CLEAR          ; Очистка профиля стола
    CLEAR_NOIZE EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
    _KAMP_BED_MESH_CALIBRATE EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp} PROFILE={profile}
